<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3D Interactive Directed Graph with Spectral Analysis</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="tutorial-styles.css">
    <link rel="icon" href="data:,">
</head>
<body>

    <div id="container"></div>
    
    <!-- Universe View Container (hidden by default) -->
    <div id="universe-container" style="display: none;"></div>

    <!-- Mobile Toggle Button -->
    <button id="mobile-menu-toggle" title="Toggle Menu">
        <span class="toggle-icon">‚ò∞</span>
    </button>

    <div id="controls-panel">
        <!-- Resize Handle -->
        <div id="sidebar-resize-handle"></div>
        
        <!-- Sidebar Tab Navigation -->
        <div class="sidebar-tabs">
            <button class="sidebar-tab active" data-tab="build" title="Build Graph">
                <span class="tab-icon">üî®</span>
                <span class="tab-label">Build</span>
            </button>
            <button class="sidebar-tab" data-tab="edit" title="Edit Edges">
                <span class="tab-icon">‚úèÔ∏è</span>
                <span class="tab-label">Edit</span>
            </button>
            <button class="sidebar-tab" data-tab="simulate" title="Dynamics">
                <span class="tab-icon">üåä</span>
                <span class="tab-label">Simulate</span>
            </button>
            <button class="sidebar-tab" data-tab="analyze" title="Analysis">
                <span class="tab-icon">üìä</span>
                <span class="tab-label">Analyze</span>
            </button>
            <button class="sidebar-tab" data-tab="bounds" title="Eigenvalue Bounds">
                <span class="tab-icon">üìê</span>
                <span class="tab-label">Bounds</span>
            </button>
            <button class="sidebar-tab" data-tab="advanced" title="Advanced Build">
                <span class="tab-icon">üîß</span>
                <span class="tab-label">Advanced</span>
            </button>
            <button class="sidebar-tab" data-tab="library" title="Graph Library">
                <span class="tab-icon">üìö</span>
                <span class="tab-label">Library</span>
            </button>
        </div>

        <!-- ==================== BUILD TAB ==================== -->
        <div id="sidebar-build" class="sidebar-tab-content active">
            
            <div class="control-group">
                <h4>Graph Layout</h4>
                <div class="input-row">
                    <label for="num-vertices">Vertices:</label>
                    <input id="num-vertices" type="number" value="8" min="2" max="100">
                </div>
                <div class="input-row">
                    <label for="layout-radius">Radius:</label>
                    <input id="layout-radius" type="number" value="40" min="10" max="100">
                </div>
                <select id="layout-type">
                    <option value="circle">Circle (2D)</option>
                    <option value="sphere">Sphere (3D)</option>
                    <option value="concentric-2">2 Concentric Circles</option>
                    <option value="concentric-3">3 Concentric Circles</option>
                    <option value="concentric-spheres-2">2 Concentric Spheres</option>
                </select>
                <div id="concentric-options" class="sub-options" style="display: none;">
                    <div class="input-row">
                        <label>Inner ratio:</label>
                        <input id="inner-ratio" type="range" min="20" max="70" value="50">
                        <span id="inner-ratio-label">50%</span>
                    </div>
                    <div id="middle-ratio-container" class="input-row" style="display: none;">
                        <label>Middle ratio:</label>
                        <input id="middle-ratio" type="range" min="40" max="80" value="70">
                        <span id="middle-ratio-label">70%</span>
                    </div>
                    <div class="input-row">
                        <label>Split:</label>
                        <select id="split-mode">
                            <option value="half">Equal parts</option>
                            <option value="custom">Custom</option>
                        </select>
                    </div>
                    <div id="custom-split-container" style="display: none;">
                        <input id="custom-split" type="text" placeholder="e.g., 5,10,5">
                    </div>
                </div>
                <button id="generate-btn">Generate Vertices</button>
            </div>
            
            <div class="control-group">
                <h4>Force-Directed Layout</h4>
                <div class="button-row">
                    <button id="force-layout-btn" class="success">‚ñ∂ Start</button>
                    <button id="stop-force-btn" class="danger" style="display: none;">‚èπ Stop</button>
                </div>
                <div class="input-row">
                    <label>Speed:</label>
                    <input id="force-speed" type="range" min="1" max="10" value="5">
                </div>
                <label class="checkbox-label">
                    <input type="checkbox" id="force-3d-checkbox">
                    <span>3D forces</span>
                </label>
                <div class="input-row" style="margin-top: 8px;">
                    <button id="unpin-all-btn" class="small secondary">üìå Unpin All</button>
                    <span id="pin-count-label" style="font-size: 11px; color: #888; margin-left: 8px;"></span>
                </div>
                <div style="font-size: 10px; color: #666; margin-top: 4px;">
                    üí° Shift+Click node to pin/unpin
                </div>
            </div>
            
            <div class="control-group">
                <h4>üé® Display Options</h4>
                <label class="checkbox-label">
                    <input type="checkbox" id="solid-faces-checkbox">
                    <span>Solid Faces (Polyhedron View)</span>
                </label>
                <div id="face-options" class="sub-options hidden">
                    <div class="input-row">
                        <label>Opacity:</label>
                        <input id="face-opacity" type="range" min="10" max="95" value="70">
                        <span id="face-opacity-label">70%</span>
                    </div>
                    <div class="input-row">
                        <label>Brightness:</label>
                        <input id="face-brightness" type="range" min="50" max="150" value="100">
                        <span id="face-brightness-label">100%</span>
                    </div>
                    <div class="input-row">
                        <label>Saturation:</label>
                        <input id="face-saturation" type="range" min="50" max="150" value="100">
                        <span id="face-saturation-label">100%</span>
                    </div>
                    <div class="input-row">
                        <label>Background:</label>
                        <select id="background-color-select">
                            <option value="dark">Dark (default)</option>
                            <option value="gray">Gray</option>
                            <option value="light">Light Gray</option>
                            <option value="white">White</option>
                            <option value="black">Black</option>
                        </select>
                    </div>
                    <button id="refresh-faces-btn" class="small secondary">üîÑ Refresh Faces</button>
                </div>
                <p class="hint hidden" id="face-hint">
                    üí° Best for polyhedra, grids, and mesh graphs
                </p>
            </div>
            
            <div class="control-group">
                <h4>Quick Templates</h4>
                <select id="template-select">
                    <option value="custom">Custom (manual edges)</option>
                    <optgroup label="‚ö° Realizable Systems">
                        <option value="mass-chain">Mass-Spring Chain (grounded ends)</option>
                        <option value="mass-star">Star Mass System (hub spring)</option>
                        <option value="mass-tree">Tree Mass System (depth d)</option>
                        <option value="mass-cantilever">Cantilever Beam</option>
                        <option value="mass-bridge">Simple Bridge/Truss</option>
                        <option value="mass-grid">Mass-Spring Grid (m√ón)</option>
                        <option value="mass-drum">Drum (radial)</option>
                        <option value="mass-drum-constrained">Drum Constrained (boundary springs)</option>
                    </optgroup>
                    <optgroup label="Basic Graphs (Table I)">
                        <option value="path">Path Graph (P‚Çô)</option>
                        <option value="cycle">Cycle Graph (C‚Çô)</option>
                        <option value="star">Star Graph (S‚Çô)</option>
                        <option value="complete">Complete Graph (K‚Çô)</option>
                    </optgroup>
                    <optgroup label="Trees with Depth (Appendix)">
                        <option value="binary-tree">Binary Tree (depth d)</option>
                        <option value="star-path">S'‚Çö Tree (depth 2, N=2p+1)</option>
                        <option value="double-star">S¬≤‚Çö Tree (depth 3, N=3p+1)</option>
                        <option value="general-star-tree">S·µà‚Çö Tree (any depth d)</option>
                        <option value="k-ary-tree">k-ary Tree (depth d)</option>
                        <option value="caterpillar">Caterpillar Graph</option>
                        <option value="spider">Spider Graph</option>
                        <option value="broom">Broom Graph</option>
                    </optgroup>
                    <optgroup label="Grid & Mesh (Table I)">
                        <option value="grid">2D Grid (m√ón)</option>
                        <option value="general-ladder">General Ladder/Truss (m√ón)</option>
                        <option value="cuboid">3D Cuboid (m√ón√ók)</option>
                        <option value="torus">Torus Grid</option>
                        <option value="n-bar-mechanism">n-Bar Mechanism (select n)</option>
                        <option value="four-bar">4-Bar Mechanism (9 nodes)</option>
                        <option value="five-bar">5-Bar Mechanism (14 nodes)</option>
                        <option value="six-bar">6-Bar Mechanism (19 nodes)</option>
                        <option value="seven-bar">7-Bar Mechanism (24 nodes)</option>
                        <option value="n-link-pendulum">n-Link Pendulum (select n)</option>
                        <option value="one-link-pendulum">1-Link Pendulum (6 nodes)</option>
                        <option value="two-link-pendulum">2-Link Pendulum (11 nodes)</option>
                        <option value="three-link-pendulum">3-Link Pendulum (16 nodes)</option>
                        <option value="ladder">Simple Ladder (L‚Çô)</option>
                        <option value="circular-ladder">Circular Ladder</option>
                        <option value="mobius-ladder">M√∂bius Ladder</option>
                    </optgroup>
                    <optgroup label="Bipartite Graphs">
                        <option value="bipartite">Complete Bipartite (K‚Çò,‚Çô)</option>
                        <option value="crown">Crown Graph</option>
                    </optgroup>
                    <optgroup label="Regular Graphs">
                        <option value="wheel">Wheel Graph (W‚Çô)</option>
                        <option value="prism">Prism Graph</option>
                        <option value="antiprism">Antiprism Graph</option>
                        <option value="cocktail">Cocktail Party</option>
                        <option value="circulant">Circulant C(n,{1,2})</option>
                    </optgroup>
                    <optgroup label="Hypercubes (Table I)">
                        <option value="hypercube">Hypercube Q‚Çê (any dim)</option>
                        <option value="hypercube2">Hypercube Q‚ÇÇ (n=4)</option>
                        <option value="hypercube3">Hypercube Q‚ÇÉ (n=8)</option>
                        <option value="hypercube4">Hypercube Q‚ÇÑ (n=16)</option>
                        <option value="hypercube5">Hypercube Q‚ÇÖ (n=32)</option>
                    </optgroup>
                    <optgroup label="Famous Graphs">
                        <option value="petersen">Petersen (n=10)</option>
                        <option value="octahedron">Octahedron (n=6)</option>
                        <option value="icosahedron">Icosahedron (n=12)</option>
                        <option value="dodecahedron">Dodecahedron (n=20)</option>
                        <option value="cuboctahedron">Cuboctahedron (n=12)</option>
                        <option value="heawood">Heawood (n=14)</option>
                        <option value="pappus">Pappus (n=18)</option>
                        <option value="desargues">Desargues (n=20)</option>
                        <option value="mobius-kantor">M√∂bius-Kantor (n=16)</option>
                        <option value="clebsch">Clebsch (n=16)</option>
                        <option value="shrikhande">Shrikhande (n=16)</option>
                        <option value="tutte-coxeter">Tutte-Coxeter (n=30)</option>
                        <option value="franklin">Franklin (n=12)</option>
                        <option value="mcgee">McGee (n=24)</option>
                        <option value="nauru">Nauru (n=24)</option>
                    </optgroup>
                    <optgroup label="Wheel Variants">
                        <option value="helm">Helm Graph H‚Çô</option>
                        <option value="gear">Gear Graph G‚Çô</option>
                        <option value="sun">Sun/Sunlet Graph</option>
                        <option value="friendship">Friendship/Windmill F‚Çô</option>
                        <option value="web">Web Graph Wb‚Çô</option>
                    </optgroup>
                    <optgroup label="Parameterized Families">
                        <option value="gen-petersen">Generalized Petersen GP(n,k)</option>
                        <option value="book">Book Graph B‚Çô</option>
                        <option value="lollipop">Lollipop Graph</option>
                        <option value="barbell">Barbell Graph</option>
                        <option value="pan">Pan/Tadpole Graph</option>
                        <option value="kneser">Kneser Graph K(n,k)</option>
                        <option value="rook">Rook Graph K‚Çò‚ñ°K‚Çô</option>
                        <option value="stacked-prism">Stacked Prism Y‚Çô</option>
                    </optgroup>
                </select>
                
                <!-- Template Preview Panel -->
                <div id="template-preview-panel" class="template-preview">
                    <canvas id="template-preview-canvas" width="160" height="120"></canvas>
                    <div id="template-preview-info">
                        <div id="preview-name">Select a template</div>
                        <div id="preview-stats"></div>
                        <div id="preview-formula"></div>
                    </div>
                </div>
                
                <!-- Configurable Parameters (shown based on template selection) -->
                <div id="template-params" class="sub-options" style="display: none;">
                    <div id="param-n" class="input-row" style="display: none;">
                        <label>Vertices (n):</label>
                        <input id="template-n" type="number" value="8" min="3" max="100">
                    </div>
                    <div id="param-depth" class="input-row" style="display: none;">
                        <label>Depth (d):</label>
                        <input id="tree-depth" type="number" value="3" min="1" max="6">
                    </div>
                    <div id="param-branches" class="input-row" style="display: none;">
                        <label>Branches (p):</label>
                        <input id="tree-branches" type="number" value="3" min="2" max="10">
                    </div>
                    <div id="param-k-ary" class="input-row" style="display: none;">
                        <label>Children (k):</label>
                        <input id="tree-k" type="number" value="3" min="2" max="5">
                    </div>
                    <div id="param-grid" class="input-row" style="display: none;">
                        <label>Rows (m):</label>
                        <input id="grid-rows" type="number" value="3" min="2" max="10">
                        <label>Cols (n):</label>
                        <input id="grid-cols" type="number" value="4" min="2" max="10">
                    </div>
                    <div id="param-cuboid" class="input-row" style="display: none;">
                        <label>m:</label>
                        <input id="cuboid-m" type="number" value="2" min="2" max="5">
                        <label>n:</label>
                        <input id="cuboid-n" type="number" value="3" min="2" max="5">
                        <label>k:</label>
                        <input id="cuboid-k" type="number" value="2" min="2" max="5">
                    </div>
                    <div id="param-hypercube" class="input-row" style="display: none;">
                        <label>Dimension:</label>
                        <input id="hypercube-dim" type="number" value="3" min="2" max="6">
                    </div>
                    <div id="param-gen-petersen" class="input-row" style="display: none;">
                        <label>n (outer):</label>
                        <input id="gp-n" type="number" value="5" min="3" max="20">
                        <label>k (jump):</label>
                        <input id="gp-k" type="number" value="2" min="1" max="9">
                    </div>
                    <div id="param-n-bar" class="input-row" style="display: none;">
                        <label>Bars (m):</label>
                        <input id="n-bar-m" type="number" value="5" min="4" max="12">
                        <span style="font-size: 10px; color: #888; margin-left: 8px;">
                            (4-bar=9 nodes, 5-bar=14, 6-bar=19...)
                        </span>
                    </div>
                    <div id="param-n-link" class="input-row" style="display: none;">
                        <label>Links (n):</label>
                        <input id="n-link-num" type="number" value="2" min="1" max="10">
                        <span style="font-size: 10px; color: #888; margin-left: 8px;">
                            (1-link=6, 2-link=11, 3-link=16...)
                        </span>
                    </div>
                    <div id="param-lollipop" class="input-row" style="display: none;">
                        <label>Clique (m):</label>
                        <input id="lollipop-m" type="number" value="4" min="3" max="10">
                        <label>Path (n):</label>
                        <input id="lollipop-n" type="number" value="3" min="1" max="10">
                    </div>
                    <div id="param-kneser" class="input-row" style="display: none;">
                        <label>n:</label>
                        <input id="kneser-n" type="number" value="5" min="3" max="10">
                        <label>k:</label>
                        <input id="kneser-k" type="number" value="2" min="1" max="4">
                    </div>
                    <div id="param-rook" class="input-row" style="display: none;">
                        <label>Rows (m):</label>
                        <input id="rook-m" type="number" value="3" min="2" max="6">
                        <label>Cols (n):</label>
                        <input id="rook-n" type="number" value="3" min="2" max="6">
                    </div>
                    <div id="param-drum" class="input-row" style="display: none;">
                        <label>Branches:</label>
                        <input id="drum-branches" type="number" value="5" min="3" max="12">
                        <label>Rings:</label>
                        <input id="drum-rings" type="number" value="2" min="1" max="5">
                    </div>
                </div>
                
                <label class="checkbox-label">
                    <input type="checkbox" id="skew-symmetric-checkbox" checked>
                    <span>Skew-symmetric (unidirectional)</span>
                </label>
                <button id="apply-template-btn" class="purple">Apply Template</button>
            </div>
            
            <!-- Universe Integration -->
            <div class="control-group">
                <h4>üåå Universe Integration</h4>
                <p class="hint">Send current graph to Universe for visualization and comparison.</p>
                <div class="input-row">
                    <label>Graph Name:</label>
                    <input id="universe-graph-name" type="text" placeholder="My Graph" style="flex: 1;">
                </div>
                <button id="send-to-universe-btn" class="info" style="width: 100%; margin-top: 8px;">
                    üöÄ Send to Universe
                </button>
                <button id="save-to-library-btn" class="secondary" style="width: 100%; margin-top: 4px;">
                    üíæ Save to Library
                </button>
                <hr style="margin: 12px 0; border-color: var(--border-color);">
                <p class="hint"><strong>Test Mode:</strong> Generate known graph families to verify Universe positioning.</p>
                
                <div class="test-graph-controls" style="margin: 8px 0; padding: 8px; background: rgba(128,0,255,0.1); border-radius: 4px;">
                    <div style="display: flex; gap: 8px; margin-bottom: 6px;">
                        <label style="flex: 1; font-size: 11px;">
                            <input type="checkbox" id="test-family-path" checked> Path
                        </label>
                        <label style="flex: 1; font-size: 11px;">
                            <input type="checkbox" id="test-family-cycle" checked> Cycle
                        </label>
                        <label style="flex: 1; font-size: 11px;">
                            <input type="checkbox" id="test-family-star" checked> Star
                        </label>
                    </div>
                    <div style="display: flex; gap: 8px; margin-bottom: 6px;">
                        <label style="flex: 1; font-size: 11px;">
                            <input type="checkbox" id="test-family-complete" checked> Complete
                        </label>
                        <label style="flex: 1; font-size: 11px;">
                            <input type="checkbox" id="test-family-wheel" checked> Wheel
                        </label>
                        <label style="flex: 1; font-size: 11px;">
                            <input type="checkbox" id="test-family-petersen" checked> Petersen
                        </label>
                    </div>
                    <div style="display: flex; gap: 8px; margin-bottom: 6px;">
                        <label style="flex: 1; font-size: 11px;">
                            <input type="checkbox" id="test-family-bipartite" checked> K(m,n)
                        </label>
                        <label style="flex: 1; font-size: 11px;">
                            <input type="checkbox" id="test-family-hypercube" checked> Hypercube
                        </label>
                        <label style="flex: 1; font-size: 11px;">
                            <input type="checkbox" id="test-family-ladder" checked> Ladder
                        </label>
                    </div>
                    <div style="display: flex; gap: 8px; margin-bottom: 6px;">
                        <label style="flex: 1; font-size: 11px;">
                            <input type="checkbox" id="test-family-prism" checked> Prism
                        </label>
                        <label style="flex: 1; font-size: 11px;">
                            <input type="checkbox" id="test-family-friendship" checked> Friendship
                        </label>
                        <label style="flex: 1; font-size: 11px;">
                            <input type="checkbox" id="test-family-book" checked> Book
                        </label>
                    </div>
                    <div style="display: flex; gap: 8px; margin-bottom: 6px;">
                        <label style="flex: 1; font-size: 11px;">
                            <input type="checkbox" id="test-family-fan" checked> Fan
                        </label>
                        <label style="flex: 1; font-size: 11px;">
                            <input type="checkbox" id="test-family-platonic" checked> Platonic
                        </label>
                        <label style="flex: 1; font-size: 11px;">
                            <input type="checkbox" id="test-family-crown"> Crown
                        </label>
                    </div>
                    <div style="display: flex; gap: 8px; margin-bottom: 6px;">
                        <label style="flex: 1; font-size: 11px;">
                            <input type="checkbox" id="test-family-gear"> Gear
                        </label>
                        <label style="flex: 1; font-size: 11px;">
                            <input type="checkbox" id="test-family-helm"> Helm
                        </label>
                        <label style="flex: 1; font-size: 11px;">
                            <input type="checkbox" id="test-family-mobius"> M√∂bius
                        </label>
                    </div>
                    <div style="display: flex; gap: 8px; margin-bottom: 6px;">
                        <label style="flex: 1; font-size: 11px;">
                            <input type="checkbox" id="test-family-turan"> Tur√°n
                        </label>
                        <label style="flex: 1; font-size: 11px;">
                            <input type="checkbox" id="test-family-fivebar"> n-Bar
                        </label>
                        <label style="flex: 1; font-size: 11px;">
                            <input type="checkbox" id="test-family-pendulum"> Pendulum
                        </label>
                    </div>
                    <div style="display: flex; gap: 8px; margin-bottom: 6px; padding-top: 4px; border-top: 1px solid rgba(128,128,128,0.3);">
                        <span style="font-size: 10px; color: #888; width: 100%;">‚öôÔ∏è Physically Realizable:</span>
                    </div>
                    <div style="display: flex; gap: 8px; margin-bottom: 6px;">
                        <label style="flex: 1; font-size: 11px;">
                            <input type="checkbox" id="test-family-mass-chain" checked> Chain
                        </label>
                        <label style="flex: 1; font-size: 11px;">
                            <input type="checkbox" id="test-family-mass-drum" checked> Drum
                        </label>
                        <label style="flex: 1; font-size: 11px;">
                            <input type="checkbox" id="test-family-mass-cantilever"> Cantilever
                        </label>
                    </div>
                    <div style="display: flex; gap: 6px; align-items: center; font-size: 11px;">
                        <span>n:</span>
                        <input type="number" id="test-n-min" value="4" min="3" max="20" style="width: 50px;">
                        <span>to</span>
                        <input type="number" id="test-n-max" value="10" min="3" max="30" style="width: 60px;">
                    </div>
                </div>
                
                <button id="test-universe-btn" class="purple" style="width: 100%; margin-top: 4px;">
                    üß™ Generate Test Graphs
                </button>
            </div>
        </div>

        <!-- ==================== EDIT TAB ==================== -->
        <div id="sidebar-edit" class="sidebar-tab-content">
            
            <div class="control-group">
                <h4>Edit Mode</h4>
                <div id="mode-indicator" class="mode-indicator mode-view">VIEW MODE</div>
                
                <div class="mode-buttons">
                    <button id="view-mode-btn" class="mode-btn active" data-mode="view">üëÅ View</button>
                    <button id="drag-mode-btn" class="mode-btn" data-mode="drag">‚úã Drag</button>
                </div>
                
                <h4 style="margin-top: 10px;">Edge Operations</h4>
                <div class="mode-buttons">
                    <button id="add-mode-btn" class="mode-btn" data-mode="add">‚ûï Add Edge</button>
                    <button id="delete-mode-btn" class="mode-btn" data-mode="delete">üóë Del Edge</button>
                </div>
                
                <h4 style="margin-top: 10px;">Vertex Operations</h4>
                <div class="mode-buttons">
                    <button id="add-vertex-mode-btn" class="mode-btn" data-mode="add-vertex">‚äï Add Node</button>
                    <button id="delete-vertex-mode-btn" class="mode-btn" data-mode="delete-vertex">‚äñ Del Node</button>
                </div>
                
                <div class="mode-hints">
                    <p class="hint" id="hint-view"><b>View:</b> Drag to rotate, scroll to zoom</p>
                    <p class="hint" id="hint-add" style="display:none;"><b>Add Edge:</b> Click source vertex, then target</p>
                    <p class="hint" id="hint-delete" style="display:none;"><b>Delete Edge:</b> Click on edge arrow</p>
                    <p class="hint" id="hint-drag" style="display:none;"><b>Drag:</b> Click and drag vertices</p>
                    <p class="hint" id="hint-add-vertex" style="display:none;"><b>Add Node:</b> Click on grid to place. Use Top/Front/Side view for 2D placement.</p>
                    <p class="hint" id="hint-delete-vertex" style="display:none;"><b>Delete Node:</b> Click on vertex to remove</p>
                </div>
            </div>
            
            <div class="control-group">
                <h4>üì∑ View Projection</h4>
                <div class="button-row projection-buttons">
                    <button id="project-xz-btn" class="small projection-btn" title="Top view (XZ plane)">Top</button>
                    <button id="project-xy-btn" class="small projection-btn" title="Front view (XY plane)">Front</button>
                    <button id="project-yz-btn" class="small projection-btn" title="Side view (YZ plane)">Side</button>
                    <button id="project-3d-btn" class="small projection-btn active" title="3D perspective view">3D</button>
                </div>
            </div>
            
            <div class="control-group">
                <h4>Arrange Layout</h4>
                <div class="input-row">
                    <label>Rows:</label>
                    <input id="arrange-rows" type="number" value="3" min="1" max="20" style="width: 50px;">
                    <label>Cols:</label>
                    <input id="arrange-cols" type="number" value="3" min="1" max="20" style="width: 50px;">
                </div>
                <div class="input-row">
                    <label>Spacing:</label>
                    <input id="arrange-spacing" type="number" value="15" min="5" max="50" style="width: 60px;">
                </div>
                <div class="button-row">
                    <button id="arrange-grid-btn" class="small">üìê Grid</button>
                    <button id="arrange-circle-btn" class="small">‚óØ Circle</button>
                </div>
            </div>
            
            <div id="snap-grid-controls" class="control-group" style="display: none;">
                <h4>üìê Snap Grid</h4>
                <div class="input-row">
                    <label>Grid Size:</label>
                    <input id="snap-grid-size" type="number" value="5" min="1" max="20" style="width: 60px;">
                </div>
                <div class="input-row">
                    <label>
                        <input type="checkbox" id="snap-to-grid-checkbox" checked>
                        Snap to Grid
                    </label>
                </div>
            </div>
            
            <div class="control-group">
                <h4>Auto Generate Edges</h4>
                <div class="input-row">
                    <label>Count:</label>
                    <input id="auto-edges" type="number" value="10" min="0" max="1000">
                    <button id="auto-generate-btn" class="success small">Add Random</button>
                </div>
                <button id="clear-edges-btn" class="danger">Clear All Edges</button>
            </div>
            
            <!-- Hidden checkboxes for compatibility -->
            <input type="checkbox" id="add-mode-checkbox" style="display:none;">
            <input type="checkbox" id="delete-mode-checkbox" style="display:none;">
            <input type="checkbox" id="drag-mode-checkbox" style="display:none;">
        </div>

        <!-- ==================== SIMULATE TAB ==================== -->
        <div id="sidebar-simulate" class="sidebar-tab-content">
            
            <div class="control-group">
                <h4>üåä Dynamics Animation</h4>
                <p class="hint">Visualize ·∫ã = Ax (skew-symmetric)</p>
                
                <div class="button-row">
                    <button id="start-dynamics-btn" class="success">‚ñ∂ Start</button>
                    <button id="stop-dynamics-btn" class="danger" style="display: none;">‚èπ Stop</button>
                    <button id="reset-dynamics-btn" class="small">‚Ü∫ Reset</button>
                </div>
                
                <div class="sub-options">
                    <div class="input-row">
                        <label>Integrator:</label>
                        <select id="integrator-select">
                            <option value="rodrigues">Rodrigues (exp)</option>
                            <option value="cayley">Cayley</option>
                            <option value="trapezoidal">Trapezoidal</option>
                        </select>
                    </div>
                    <div class="input-row">
                        <label>Time Step:</label>
                        <select id="timestep-select">
                            <option value="1e-6">10‚Åª‚Å∂ (coarse)</option>
                            <option value="1e-7" selected>10‚Åª‚Å∑ (default)</option>
                            <option value="1e-8">10‚Åª‚Å∏ (fine)</option>
                        </select>
                    </div>
                    <div class="input-row">
                        <label>Speed:</label>
                        <input id="dynamics-speed" type="range" min="1" max="20" value="10">
                        <span id="dynamics-speed-label">1.0x</span>
                    </div>
                    <div class="input-row">
                        <label>Arrow Scale:</label>
                        <input id="arrow-scale" type="range" min="5" max="80" value="30">
                        <span id="arrow-scale-label">30</span>
                    </div>
                    <div class="input-row">
                        <label>Base Length:</label>
                        <input id="arrow-min-length" type="range" min="0" max="20" value="8">
                        <span id="arrow-min-label">8</span>
                    </div>
                </div>
                
                <div class="stats-grid">
                    <div class="stat-item">
                        <span class="stat-label">Time</span>
                        <span id="dynamics-time" class="stat-value blue">0.00s</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Max |x|</span>
                        <span id="dynamics-max-state" class="stat-value orange">0.00</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Max Flow</span>
                        <span id="dynamics-max-flow" class="stat-value pink">0.00</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Energy</span>
                        <span id="dynamics-energy" class="stat-value green">--</span>
                    </div>
                </div>
            </div>
            
            <div class="control-group">
                <h4>üìà Phase Diagram</h4>
                <div class="input-row">
                    <label>Plot:</label>
                    <select id="phase-mode-select">
                        <option value="displacement">x·µ¢ vs x‚±º</option>
                        <option value="velocity">x·µ¢ vs ·∫ã‚±º</option>
                        <option value="node-power">x·µ¢ vs x·µ¢·∫ã·µ¢</option>
                        <option value="power-power">Power vs Power</option>
                        <option value="edge-power">Edge Power</option>
                    </select>
                </div>
                <div id="phase-mode-explanation" class="hint-box">
                    <span id="phase-mode-hint">Ellipse shape reveals phase relationship between nodes</span>
                </div>
                <div class="input-row">
                    <label>Animation:</label>
                    <select id="animation-mode-select">
                        <option value="displacement">Displacement</option>
                        <option value="power">Power</option>
                    </select>
                </div>
                <div id="animation-mode-explanation" class="hint-box power-mode-hint">
                    <span id="animation-mode-hint">Color shows node state magnitude</span>
                </div>
                <label class="checkbox-label teaching-toggle" id="freeze-nodes-container" style="display: none;">
                    <input type="checkbox" id="freeze-nodes-checkbox">
                    <span>üéì Freeze nodes (show only edge exchange)</span>
                </label>
                <div class="input-row">
                    <label>Nodes:</label>
                    <select id="phase-node-i" class="small-select"></select>
                    <span>vs</span>
                    <select id="phase-node-j" class="small-select"></select>
                </div>
                <label class="checkbox-label">
                    <input type="checkbox" id="phase-enabled-checkbox">
                    <span>Show Phase Plot</span>
                </label>
                <button id="clear-phase-btn" class="small">Clear Trail</button>
                <button id="open-enhanced-viz-btn" class="purple small" style="margin-left: 5px;">üìä Enhanced View</button>
                <canvas id="phase-canvas" width="300" height="300" style="display: none;"></canvas>
                <div id="phase-axis-labels" style="display: none;">
                    X: <span id="phase-x-label">x·µ¢</span> | Y: <span id="phase-y-label">x‚±º</span>
                </div>
            </div>
            
            <div class="control-group">
                <h4>üéØ Eigenvalue Analysis</h4>
                <p class="hint">üìä See <strong>ANALYZE</strong> tab for full complex plane with Œ±/Œ≤ controls</p>
                <!-- Hidden elements for compatibility -->
                <input id="phase-alpha" type="hidden" value="10">
                <input id="phase-beta" type="hidden" value="10">
                <span id="phase-alpha-label" style="display:none;">1.0</span>
                <span id="phase-beta-label" style="display:none;">1.0</span>
                <canvas id="eigenvalue-canvas" width="1" height="1" style="display: none;"></canvas>
                <div id="eigenvalue-info-display" style="display: none;"></div>
                <input type="checkbox" id="eigenvalue-plot-checkbox" style="display:none;">
            </div>
        </div>

        <!-- ==================== ANALYZE TAB ==================== -->
        <div id="sidebar-analyze" class="sidebar-tab-content">
            
            <!-- Physics Realizability Panel -->
            <div class="control-group" id="physics-panel">
                <details class="collapsible" open>
                    <summary>
                        <h4 style="display:inline;">‚öõÔ∏è Linear System Realizability</h4>
                        <span id="physics-status-badge" class="physics-badge"></span>
                    </summary>
                    
                    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
                    <!-- INPUT SECTION: Configure the partition -->
                    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
                    <div class="physics-input-section">
                        <div class="physics-section-label">‚ë† CONFIGURE PARTITION</div>
                        
                        <div class="physics-n-row">
                            <label>N (absolute states):</label>
                            <input type="number" id="physics-n-value" min="1" value="3" style="width: 60px;">
                            <button id="physics-auto-discover-btn" class="physics-btn discover" title="Auto-discover bipartite partition">üîÆ Auto</button>
                        </div>
                        
                        <!-- Clickable Partition Grid -->
                        <div id="physics-partition-container" class="physics-partition-container">
                            <div class="physics-partition-instructions">
                                Click to toggle: <span class="p-label">p (momentum)</span> ‚Üî <span class="q-label">q (displacement)</span>
                            </div>
                            <div id="physics-node-grid" class="physics-node-grid"></div>
                            <div class="physics-partition-summary">
                                <span>p: <span id="physics-p-indices" class="p-label">-</span></span>
                                <span>q: <span id="physics-q-indices" class="q-label">-</span></span>
                            </div>
                        </div>
                        
                        <!-- Audit Button (Primary Action) -->
                        <div class="physics-audit-row">
                            <button id="physics-audit-btn" class="physics-btn audit">üîç Audit Realizability</button>
                            <label class="physics-auto-label">
                                <input type="checkbox" id="physics-auto-audit" checked>
                                <span>Auto</span>
                            </label>
                        </div>
                    </div>
                    
                    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
                    <!-- OUTPUT SECTION: Results and Status -->
                    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
                    <div class="physics-output-section">
                        <div class="physics-section-label">‚ë° AUDIT RESULTS</div>
                        
                        <!-- Status Summary Card -->
                        <div class="physics-status-card">
                            <div id="physics-status-indicator" class="physics-status-dot"></div>
                            <span id="physics-status-text">Click Audit to check</span>
                        </div>
                        
                        <!-- Dimensions Display -->
                        <div class="physics-dims-grid">
                            <div class="physics-dim-item">
                                <span class="physics-dim-label">N (absolute)</span>
                                <span id="physics-dim-n" class="physics-dim-value">-</span>
                            </div>
                            <div class="physics-dim-item">
                                <span class="physics-dim-label">M (relative)</span>
                                <span id="physics-dim-m" class="physics-dim-value">-</span>
                            </div>
                            <div class="physics-dim-item">
                                <span class="physics-dim-label">Violations</span>
                                <span id="physics-dim-violations" class="physics-dim-value violation-count">-</span>
                            </div>
                        </div>
                        
                        <!-- Rectification Prompt (when non-realizable) -->
                        <div id="physics-rectify-prompt" class="physics-rectify-prompt" style="display: none;">
                            <div class="physics-rectify-message">
                                <span class="physics-rectify-icon">‚ö†Ô∏è</span>
                                <span>Graph is <strong>not realizable</strong> for linear system.</span>
                            </div>
                            <div class="physics-rectify-question">
                                Would you like to rectify the graph?
                            </div>
                            <div class="physics-rectify-note">
                                Rectification adjusts edge signs to satisfy Newton's 3rd Law.
                            </div>
                            <button id="physics-rectify-yes-btn" class="physics-btn rectify-yes">‚úì Yes, Rectify Graph</button>
                        </div>
                        
                        <!-- Undo Rectification (after rectification) -->
                        <div id="physics-undo-panel" class="physics-undo-panel" style="display: none;">
                            <div class="physics-undo-message">
                                <span class="physics-undo-icon">‚úì</span>
                                <span>Graph <strong>rectified</strong> successfully.</span>
                            </div>
                            <button id="physics-undo-btn" class="physics-btn undo">‚Ü© Undo Rectification</button>
                        </div>
                        
                        <!-- Column-by-Column Analysis -->
                        <div id="physics-column-analysis" class="physics-column-analysis">
                            <div class="physics-column-header">Column Analysis</div>
                            <div id="physics-column-list" class="physics-column-list"></div>
                        </div>
                        
                        <!-- Violations Detail Panel -->
                        <div id="physics-violations-panel" class="physics-violations" style="display: none;">
                            <div class="physics-violations-header">‚ö†Ô∏è Newton's 3rd Law Violations</div>
                            <ul id="physics-violations-list" class="physics-violations-list"></ul>
                        </div>
                    </div>
                    
                    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
                    <!-- SIMULATION SECTION: Hamiltonian Dynamics -->
                    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
                    <div class="physics-simulation-section">
                        <div class="physics-section-label">‚ë¢ HAMILTONIAN DYNAMICS</div>
                        
                        <!-- State Space Visualization -->
                        <div class="physics-state-section">
                            <div class="physics-state-header">
                                <span>State Vector x = [p | q]·µÄ</span>
                            </div>
                            <div class="physics-state-container">
                                <div class="physics-state-block physics-p-block">
                                    <div class="physics-block-label">p (momenta)</div>
                                    <div id="physics-p-states" class="physics-state-cells"></div>
                                </div>
                                <div class="physics-state-divider">
                                    <div class="physics-divider-line"></div>
                                    <div class="physics-divider-label">|</div>
                                    <div class="physics-divider-line"></div>
                                </div>
                                <div class="physics-state-block physics-q-block">
                                    <div class="physics-block-label">q (displacements)</div>
                                    <div id="physics-q-states" class="physics-state-cells"></div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Real-time Hamiltonian Plot -->
                        <div class="physics-hamiltonian-section">
                            <div class="physics-hamiltonian-header">
                                <span>H(t) = T + V</span>
                                <div class="physics-hamiltonian-controls">
                                    <button id="physics-play-btn" class="physics-mini-btn" title="Play/Pause">‚ñ∂</button>
                                    <button id="physics-reset-btn" class="physics-mini-btn" title="Reset">‚Ü∫</button>
                                </div>
                            </div>
                            <div class="physics-energy-live">
                                <div class="physics-energy-values">
                                    <span class="physics-t-value">T = <span id="physics-live-kinetic">0.000</span></span>
                                    <span class="physics-v-value">V = <span id="physics-live-potential">0.000</span></span>
                                    <span class="physics-h-value">H = <span id="physics-live-total">0.000</span></span>
                                </div>
                                <canvas id="physics-energy-canvas" width="260" height="80"></canvas>
                                <div class="physics-plot-legend">
                                    <span class="legend-h">‚îÅ H (total)</span>
                                    <span class="legend-t">‚îÅ T (kinetic)</span>
                                    <span class="legend-v">‚îÅ V (potential)</span>
                                </div>
                            </div>
                            <div class="physics-time-display">
                                t = <span id="physics-time-value">0.00</span>s
                                <span id="physics-conservation-status" class="physics-conservation-ok">Energy Conserved ‚úì</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
                    <!-- DETAILS SECTION: System Matrix (collapsible) -->
                    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
                    <div class="physics-bmatrix-section">
                        <div class="physics-bmatrix-header">
                            <span>System Matrix A = [0, B; -B·µÄ, 0]</span>
                            <button id="physics-toggle-bmatrix" class="physics-toggle-btn">Show</button>
                        </div>
                        <div id="physics-bmatrix-container" class="physics-bmatrix-container" style="display: none;">
                            <pre id="physics-bmatrix-content" class="physics-bmatrix-content"></pre>
                        </div>
                    </div>
                    
                </details>
            </div>
            
            <div class="control-group">
                <h4>Graph Info</h4>
                <div id="graph-type-display">
                    <div class="graph-type-box">
                        <span id="stat-type">Unknown</span>
                    </div>
                </div>
                <div class="stats-grid">
                    <div class="stat-item">
                        <span class="stat-label">Vertices</span>
                        <span id="stat-vertices" class="stat-value">0</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Edges</span>
                        <span id="stat-edges" class="stat-value">0</span>
                    </div>
                </div>
                <div id="graph-properties"></div>
            </div>
            
            <div class="control-group">
                <h4>Symmetric Eigenvalues <button id="copy-sym-eig-btn" class="copy-btn" title="Copy to clipboard">üìã</button></h4>
                <div id="analytic-formula-display" class="formula-display">
                    <span class="hint">Generate a graph to see eigenvalues</span>
                </div>
                <details class="collapsible" open>
                    <summary>Numerical Values <span class="eigenmode-play-hint">(click to animate)</span></summary>
                    <div id="eigenvalues-display" class="eigenvalues-list"></div>
                </details>
                <button id="reset-eigenmode-btn" class="secondary" style="margin-top: 8px; width: 100%;">
                    ‚èπ Restore Original Graph Shape
                </button>
            </div>
            
            <div class="control-group">
                <h4>Skew-Symmetric Eigenvalues <button id="copy-skew-eig-btn" class="copy-btn" title="Copy to clipboard">üìã</button></h4>
                <div id="skew-analytic-formula-display" class="formula-display">
                    <span class="hint">Eigenvalues are purely imaginary: ¬±iŒª</span>
                </div>
                <details class="collapsible">
                    <summary>Numerical Values</summary>
                    <div id="skew-eigenvalues-display" class="eigenvalues-list"></div>
                </details>
            </div>
            
            <div class="control-group">
                <h4>üìä Complex Plane (All Eigenvalues)</h4>
                <p class="hint">System eigenvalues: Œª = ‚àíŒ± ¬± i¬∑Œ≤¬∑b where b is graph eigenvalue</p>
                <div class="input-row">
                    <label>Œ± (damping):</label>
                    <input id="analyze-alpha" type="range" min="0" max="50" value="10" step="1">
                    <span id="analyze-alpha-label">1.0</span>
                </div>
                <div class="input-row">
                    <label>Œ≤ (coupling):</label>
                    <input id="analyze-beta" type="range" min="1" max="50" value="10" step="1">
                    <span id="analyze-beta-label">1.0</span>
                </div>
                <div id="complex-plane-container">
                    <canvas id="analyze-complex-plane" width="300" height="240"></canvas>
                    <div class="canvas-legend">
                        <span class="legend-item"><span class="dot stable"></span> Stable</span>
                        <span class="legend-item"><span class="dot bound"></span> Bounds</span>
                        <span class="legend-item"><span class="dot eigenvalue"></span> Œª values</span>
                    </div>
                    <div id="complex-plane-info" class="eigenvalue-info">
                        <span id="analyze-ev-count">0 eigenvalues</span>
                        <span id="analyze-stability" class="stability-badge stable">Stable</span>
                    </div>
                    <div id="eigenvalue-tooltip" class="eigenvalue-tooltip"></div>
                </div>
            </div>
            
            <div class="control-group">
                <details class="collapsible">
                    <summary><h4 style="display:inline;">Characteristic Polynomial</h4></summary>
                    <div style="margin-bottom: 8px;"><button id="copy-charpoly-btn" class="copy-btn" title="Copy to clipboard">üìã Copy</button></div>
                    <div id="char-polynomial-display" class="polynomial-display"></div>
                </details>
            </div>
            
            <div class="control-group">
                <details class="collapsible">
                    <summary><h4 style="display:inline;">Adjacency Matrices</h4></summary>
                    <h5>Directed (Skew-Symmetric) <button id="copy-skew-matrix-btn" class="copy-btn small" title="Copy to clipboard">üìã</button></h5>
                    <div id="matrix-display" class="matrix-scroll"></div>
                    <h5>Undirected (Symmetric) <button id="copy-sym-matrix-btn" class="copy-btn small" title="Copy to clipboard">üìã</button></h5>
                    <div id="symmetric-matrix-display" class="matrix-scroll"></div>
                </details>
            </div>
            
            <!-- Hidden elements for compatibility -->
            <div id="analytic-eigenvalues-display" style="display:none;"></div>
            <div id="skew-analytic-eigenvalues-display" style="display:none;"></div>
            <input id="show-complex-plane" type="hidden" value="true">
        </div>

        <!-- ==================== BOUNDS TAB (Zeid-Rosenberg) ==================== -->
        <div id="sidebar-bounds" class="sidebar-tab-content">
            
            <div class="control-group">
                <h4>üìê Point Graph Topology</h4>
                <div id="point-graph-type" class="graph-type-box">
                    <span id="zr-topology">Detect from graph</span>
                </div>
                <button id="detect-topology-btn" class="info small">Detect Topology</button>
            </div>
            
            <div class="control-group">
                <h4>Physical Parameters</h4>
                <p class="hint">These sync with ANALYZE tab's complex plane</p>
                <div class="input-row">
                    <label>Œ± (damping):</label>
                    <input id="zr-alpha-slider" type="range" min="0" max="50" value="10" step="1">
                    <span id="zr-alpha-label">1.0</span>
                </div>
                <div class="input-row">
                    <label>Œ≤ (coupling):</label>
                    <input id="zr-beta-slider" type="range" min="1" max="50" value="10" step="1">
                    <span id="zr-beta-label">1.0</span>
                </div>
                <!-- Hidden number inputs for backward compatibility -->
                <input id="zr-alpha" type="hidden" value="1.0">
                <input id="zr-beta" type="hidden" value="1.0">
                <p class="hint" style="margin-top:8px;">üìä See <strong>ANALYZE</strong> tab for complex plane visualization</p>
            </div>
            
            <div class="control-group">
                <h4>Eigenvalue Bounds (Table I)</h4>
                <div id="zr-formula" class="formula-display">
                    <span class="hint">Bounds update as Œ±,Œ≤ change</span>
                </div>
                <div id="zr-bounds-display" class="bounds-display"></div>
            </div>
            
            <div class="control-group">
                <h4>Stability Analysis</h4>
                <div id="zr-stability" class="stability-display">
                    <span class="hint">Based on Main Results 1 & 2</span>
                </div>
            </div>
            
            <div class="control-group">
                <details class="collapsible">
                    <summary><h4 style="display:inline;">üî¨ Compare with Numerical</h4></summary>
                    <div id="zr-comparison" class="comparison-display">
                        <span class="hint">Shows how tight the bounds are</span>
                    </div>
                    <button id="compare-bounds-btn" class="small">Compare</button>
                </details>
            </div>
            
            <div class="control-group">
                <details class="collapsible">
                    <summary><h4 style="display:inline;">‚äï Direct Sum</h4></summary>
                    <p class="hint">Combine two graph spectra: G = G‚ÇÅ ‚äï G‚ÇÇ</p>
                    <div class="input-row">
                        <label>G‚ÇÅ:</label>
                        <select id="directsum-g1">
                            <option value="current">Current Graph</option>
                            <option value="path3">Path P‚ÇÉ</option>
                            <option value="path4">Path P‚ÇÑ</option>
                            <option value="cycle4">Cycle C‚ÇÑ</option>
                            <option value="star4">Star S‚ÇÑ</option>
                        </select>
                    </div>
                    <div class="input-row">
                        <label>G‚ÇÇ:</label>
                        <select id="directsum-g2">
                            <option value="path3">Path P‚ÇÉ</option>
                            <option value="path4">Path P‚ÇÑ</option>
                            <option value="cycle4">Cycle C‚ÇÑ</option>
                            <option value="star4">Star S‚ÇÑ</option>
                        </select>
                    </div>
                    <button id="compute-directsum-btn" class="small">Compute G‚ÇÅ ‚äï G‚ÇÇ</button>
                    <div id="directsum-result" class="bounds-display"></div>
                </details>
            </div>
            
            <div class="control-group">
                <details class="collapsible">
                    <summary><h4 style="display:inline;">üìñ Reference (Table I & Appendix)</h4></summary>
                    <div class="reference-table">
                        <table class="formula-table">
                            <tr><th>Graph</th><th>b‚ÇÅ/Œ≤</th></tr>
                            <tr><td>Path P‚Çô</td><td>2cos(œÄ/(N+1))</td></tr>
                            <tr><td>Cycle C‚Çô</td><td>2</td></tr>
                            <tr><td>Star S‚Çô</td><td>‚àö(N-1)</td></tr>
                            <tr><td>S'‚Çö (N=2p+1)</td><td>‚àö(p+1)</td></tr>
                            <tr><td>S¬≤‚Çö (N=3p+1)</td><td>‚àö((p/2+1)+‚àö((p/2)¬≤+1))</td></tr>
                            <tr><td>Complete K‚Çô</td><td>cot(œÄ/2N)</td></tr>
                            <tr><td>Grid m√ón</td><td>2cos(œÄ/(m+1))+2cos(œÄ/(n+1))</td></tr>
                            <tr><td>General Ladder m√ón</td><td>2cos(œÄ/(n+1))+‚àö(m+1)</td></tr>
                            <tr><td>Simple Ladder L‚Çô</td><td>2cos(œÄ/(n+1))+1</td></tr>
                            <tr><td>Circular Ladder</td><td>3</td></tr>
                            <tr><td>Hypercube Q‚Çê</td><td>d</td></tr>
                            <tr><td>Wheel W‚Çô</td><td>‚âà ‚àö(N-1)+1</td></tr>
                            <tr><td>General Tree</td><td>‚â§ ‚àö(N-1)</td></tr>
                            <tr><td>General</td><td>‚â§ cot(œÄ/2N)</td></tr>
                        </table>
                    </div>
                </details>
            </div>
        </div>

        <!-- ==================== BUILD ADVANCED TAB ==================== -->
        <div id="sidebar-advanced" class="sidebar-tab-content">
            
            <div class="control-group">
                <h4>üîó Graph Products</h4>
                <p class="hint">Combine graphs with known eigenspectra</p>
                
                <div class="product-builder">
                    <div class="input-row">
                        <label>Graph A:</label>
                        <select id="product-graph-a">
                            <option value="current">‚òÖ Current Graph</option>
                            <optgroup label="Basic Families">
                                <option value="path">Path P‚Çô</option>
                                <option value="cycle">Cycle C‚Çô</option>
                                <option value="star">Star S‚Çô</option>
                                <option value="complete">Complete K‚Çô</option>
                            </optgroup>
                            <optgroup label="‚ö° Realizable Systems">
                                <option value="mass-chain">Mass-Spring Chain</option>
                                <option value="mass-star">Star Mass System</option>
                                <option value="mass-cantilever">Cantilever Beam</option>
                                <option value="mass-drum">Drum (Radial)</option>
                            </optgroup>
                            <optgroup id="product-a-library" label="üìö From Library">
                                <!-- Populated dynamically -->
                            </optgroup>
                        </select>
                    </div>
                    <div id="product-n-a-row" class="input-row" style="display:none;">
                        <label>n(A):</label>
                        <input id="product-n-a" type="number" value="4" min="2" max="20">
                    </div>
                    
                    <div class="product-operator">
                        <select id="product-type">
                            <option value="cartesian">‚ñ° Cartesian (G‚ñ°H)</option>
                            <option value="tensor">‚äó Tensor (G‚äóH)</option>
                            <option value="strong">‚ä† Strong (G‚ä†H)</option>
                            <option value="realizable">‚ö° Realizable (preserves p/q)</option>
                        </select>
                    </div>
                    
                    <div class="input-row">
                        <label>Graph B:</label>
                        <select id="product-graph-b">
                            <optgroup label="Basic Families">
                                <option value="path" selected>Path P‚Çô</option>
                                <option value="cycle">Cycle C‚Çô</option>
                                <option value="star">Star S‚Çô</option>
                                <option value="complete">Complete K‚Çô</option>
                            </optgroup>
                            <optgroup label="‚ö° Realizable Systems">
                                <option value="mass-chain">Mass-Spring Chain</option>
                                <option value="mass-star">Star Mass System</option>
                                <option value="mass-cantilever">Cantilever Beam</option>
                                <option value="mass-drum">Drum (Radial)</option>
                            </optgroup>
                            <option value="current">‚òÖ Current Graph</option>
                            <optgroup id="product-b-library" label="üìö From Library">
                                <!-- Populated dynamically -->
                            </optgroup>
                        </select>
                    </div>
                    <div id="product-n-b-row" class="input-row">
                        <label>n(B):</label>
                        <input id="product-n-b" type="number" value="3" min="2" max="20">
                    </div>
                    
                    <div id="product-preview" class="preview-box">
                        <span class="preview-title">Result:</span>
                        <span id="product-result-name">Current ‚ñ° P‚ÇÉ (extrusion)</span>
                        <span id="product-result-vertices">Vertices: depends on current graph</span>
                        <span id="product-result-formula">Œª·µ¢‚±º = Œª·µ¢(A) + Œº‚±º(B)</span>
                    </div>
                    
                    <button id="build-product-btn" class="success">Build Product Graph</button>
                </div>
            </div>
            
            <div class="control-group">
                <h4>üìê Parameterized Families</h4>
                <p class="hint">Build graphs with explicit eigenvalue formulas</p>
                
                <div class="input-row">
                    <label>Family:</label>
                    <select id="param-family">
                        <option value="s-tree">S·µà‚Çö Tree (depth d, branches p)</option>
                        <option value="circulant">Circulant C(n, S)</option>
                        <option value="gp">Generalized Petersen GP(n, k)</option>
                        <option value="prism">Prism Graph Y‚Çò</option>
                        <option value="antiprism">Antiprism A‚Çò</option>
                        <option value="mobius">M√∂bius Ladder M‚ÇÇ‚Çô</option>
                    </select>
                </div>
                
                <!-- S-tree parameters -->
                <div id="params-s-tree" class="family-params">
                    <div class="input-row">
                        <label>Depth d:</label>
                        <input id="stree-d" type="range" min="2" max="5" value="2">
                        <span id="stree-d-label">2</span>
                    </div>
                    <div class="input-row">
                        <label>Branches p:</label>
                        <input id="stree-p" type="range" min="2" max="10" value="4">
                        <span id="stree-p-label">4</span>
                    </div>
                    <div class="param-info">
                        <span id="stree-vertices">N = d¬∑p + 1 = 9</span>
                        <span id="stree-formula">Œª = ¬±‚àö(p+1), ¬±1 (√óp-1), 0</span>
                    </div>
                </div>
                
                <!-- Circulant parameters -->
                <div id="params-circulant" class="family-params" style="display:none;">
                    <div class="input-row">
                        <label>n:</label>
                        <input id="circulant-n" type="number" value="8" min="4" max="30">
                    </div>
                    <div class="input-row">
                        <label>Step set S:</label>
                        <input id="circulant-steps" type="text" value="1,2" placeholder="e.g., 1,2,3">
                    </div>
                    <div class="param-info">
                        <span id="circulant-info">C(8, {1,2}): 8 vertices, 4-regular</span>
                    </div>
                </div>
                
                <!-- Generalized Petersen parameters -->
                <div id="params-gp" class="family-params" style="display:none;">
                    <div class="input-row">
                        <label>n:</label>
                        <input id="gp-n" type="number" value="5" min="3" max="20">
                    </div>
                    <div class="input-row">
                        <label>k:</label>
                        <input id="gp-k" type="number" value="2" min="1" max="10">
                    </div>
                    <div class="param-info">
                        <span id="gp-info">GP(5,2) = Petersen: 10 vertices</span>
                    </div>
                </div>
                
                <!-- Prism/Antiprism/M√∂bius parameters -->
                <div id="params-prism" class="family-params" style="display:none;">
                    <div class="input-row">
                        <label>m:</label>
                        <input id="prism-m" type="number" value="5" min="3" max="20">
                    </div>
                    <div class="param-info">
                        <span id="prism-info">Prism Y‚ÇÖ: 10 vertices</span>
                    </div>
                </div>
                
                <button id="build-family-btn" class="purple">Build Parameterized Graph</button>
            </div>
            
            <div class="control-group">
                <h4>üîç Find Analytic Graphs</h4>
                <p class="hint">Hierarchical search with product graph optimization</p>
                <div class="input-row">
                    <label>Vertices:</label>
                    <input id="finder-vertices" type="number" value="5" min="3" max="8">
                    <span class="badge warning">n ‚â§ 8</span>
                </div>
                <label class="checkbox-label">
                    <input type="checkbox" id="finder-connected-only" checked>
                    <span>Connected only</span>
                    <span class="badge success">faster</span>
                </label>
                <div class="button-row">
                    <button id="find-analytic-btn" class="info">Find All Analytic Graphs</button>
                    <button id="cancel-search-btn" class="warning" style="display:none;">Cancel</button>
                </div>
                <div id="finder-progress" style="display: none;">
                    <div id="finder-status">Searching...</div>
                    <div class="progress-bar">
                        <div id="finder-progress-bar"></div>
                    </div>
                </div>
                <div id="finder-results" style="display: none;">
                    <div id="finder-summary"></div>
                    <select id="analytic-graph-select">
                        <option value="">-- Select a graph --</option>
                    </select>
                    <div class="input-row" style="margin-top: 8px;">
                        <label>Layout:</label>
                        <select id="finder-layout-select">
                            <option value="circle">Circle</option>
                            <option value="sphere">Sphere</option>
                            <option value="concentric2">2-Ring</option>
                            <option value="concentric3">3-Ring</option>
                        </select>
                    </div>
                    <div id="selected-graph-info" style="display: none;">
                        <div id="graph-family"></div>
                        <div id="graph-edges"></div>
                        <div id="graph-eigenvalues"></div>
                    </div>
                    <div class="button-row">
                        <button id="load-analytic-graph-btn" class="success">Load Selected</button>
                        <button id="add-to-library-btn" class="purple" title="Add selected to library">üìö Add</button>
                    </div>
                    <div class="button-row" style="margin-top: 8px;">
                        <button id="add-all-to-library-btn" class="info small" title="Add all search results to library">üìö Add All to Library</button>
                    </div>
                    <button id="clear-db-btn" class="secondary" style="margin-top:8px; font-size:11px;">Clear Cache</button>
                </div>
            </div>
            
            <div class="control-group">
                <details class="collapsible">
                    <summary><h4 style="display:inline;">üìñ Product Eigenvalue Formulas</h4></summary>
                    <div class="reference-table">
                        <table class="formula-table">
                            <tr><th>Product</th><th>Eigenvalues</th></tr>
                            <tr><td>G ‚ñ° H (Cartesian)</td><td>Œª·µ¢(G) + Œº‚±º(H)</td></tr>
                            <tr><td>G ‚äó H (Tensor)</td><td>Œª·µ¢(G) ¬∑ Œº‚±º(H)</td></tr>
                            <tr><td>G ‚ä† H (Strong)</td><td>(1+Œª·µ¢)(1+Œº‚±º) - 1</td></tr>
                        </table>
                        <p class="hint" style="margin-top:8px;">
                            <b>Extrusion:</b> 2D mesh √ó P‚Çô = 3D extruded mesh<br>
                            Example: Cycle √ó Path = Cylinder surface
                        </p>
                    </div>
                </details>
            </div>
        </div>

        <!-- ==================== LIBRARY TAB ==================== -->
        <div id="sidebar-library" class="sidebar-tab-content">
            
            <div class="control-group">
                <h4>üìö Analytic Graph Library</h4>
                <p class="hint">Persistent storage for graphs with closed-form eigenvalues</p>
                
                <!-- VIEW TOGGLE -->
                <div class="view-toggle-container">
                    <button id="library-view-table" class="view-toggle-btn active" title="Table View">
                        <span class="view-icon">üìã</span> Table
                    </button>
                    <button id="library-view-universe" class="view-toggle-btn" title="Universe View (3D)">
                        <span class="view-icon">üåå</span> Universe
                    </button>
                </div>
                
                <div id="library-stats" class="library-stats">
                    <div class="stat-mini">
                        <span class="stat-mini-value" id="lib-total">0</span>
                        <span class="stat-mini-label">Graphs</span>
                    </div>
                    <div class="stat-mini">
                        <span class="stat-mini-value" id="lib-families">0</span>
                        <span class="stat-mini-label">Families</span>
                    </div>
                </div>
            </div>
            
            <!-- UNIVERSE NAVIGATION (shown only in universe view) -->
            <div id="universe-nav-controls" class="control-group" style="display: none;">
                <h4>üöÄ Universe Navigation</h4>
                <div class="button-row" style="margin-top: 8px;">
                    <button id="universe-reset-view" class="secondary small">Reset View</button>
                    <button id="universe-zoom-fit" class="info small">Fit All</button>
                </div>
                
                <h5 style="margin-top: 12px;">üì∑ View Projection</h5>
                <div class="button-row projection-buttons">
                    <button id="universe-project-xz-btn" class="small projection-btn" title="Top view (XZ plane)">Top</button>
                    <button id="universe-project-xy-btn" class="small projection-btn" title="Front view (XY plane)">Front</button>
                    <button id="universe-project-yz-btn" class="small projection-btn" title="Side view (YZ plane)">Side</button>
                    <button id="universe-project-3d-btn" class="small projection-btn active" title="3D perspective view">3D</button>
                </div>
                
                <p class="hint" style="margin-top: 10px;">
                    <strong>Mouse Controls:</strong><br>
                    ‚Ä¢ Drag: rotate (3D) / pan (2D views)<br>
                    ‚Ä¢ Shift+drag or middle-drag: pan<br>
                    ‚Ä¢ Scroll: zoom<br>
                    ‚Ä¢ Right-drag: rubber band zoom<br>
                    ‚Ä¢ Double-click: load graph
                </p>
            </div>
            
            <div class="control-group library-table-container">
                <div id="library-table-wrapper">
                    <table id="library-table" class="library-table">
                        <thead>
                            <tr>
                                <th class="col-select"><input type="checkbox" id="library-select-all"></th>
                                <th class="col-name">Name</th>
                                <th class="col-n">n</th>
                                <th class="col-edges">E</th>
                                <th class="col-actions">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="library-table-body">
                            <!-- Library entries will be populated here -->
                        </tbody>
                    </table>
                    <div id="library-empty" class="library-empty" style="display:none;">
                        <div class="empty-icon">üìö</div>
                        <div class="empty-title">Library is empty</div>
                        <div class="empty-hint">Use the ADVANCED tab to find analytic graphs,<br>then add them to your library.</div>
                    </div>
                </div>
            </div>
            
            <div class="control-group">
                <h4>üì§ Actions</h4>
                <div class="button-row">
                    <button id="library-load-selected" class="success small" disabled>Load Selected</button>
                    <button id="library-delete-selected" class="danger small" disabled>Delete</button>
                </div>
                <div class="button-row" style="margin-top: 8px;">
                    <button id="library-export-json" class="info small">Export JSON</button>
                    <button id="library-export-html" class="secondary small">Export HTML</button>
                </div>
                <div class="button-row" style="margin-top: 8px;">
                    <button id="library-import-btn" class="purple small">Import JSON</button>
                    <input type="file" id="library-import-file" accept=".json" style="display:none;">
                </div>
            </div>
            
            <div class="control-group">
                <details class="collapsible">
                    <summary><h4 style="display:inline;">‚ö†Ô∏è Danger Zone</h4></summary>
                    <div style="padding-top: 10px;">
                        <button id="library-clear-all" class="danger">Clear Entire Library</button>
                        <p class="hint" style="margin-top: 8px;">This cannot be undone!</p>
                    </div>
                </details>
            </div>
        </div>
    </div>

    <!-- Keep modal for backward compatibility but hidden -->
    <div id="matrix-modal" style="display:none;"></div>
    <button id="show-matrix-btn" style="display:none;"></button>
    <button id="close-modal" style="display:none;"></button>

    <!-- Enhanced Visualization Popup -->
    <div id="enhanced-viz-popup" class="enhanced-popup" style="display:none;">
        <div class="popup-header">
            <span class="popup-title">üìä Enhanced Visualization Dashboard</span>
            <div class="popup-controls">
                <button id="popup-minimize" class="popup-btn" title="Minimize">‚àí</button>
                <button id="popup-maximize" class="popup-btn" title="Maximize">‚ñ°</button>
                <button id="popup-close" class="popup-btn" title="Close">√ó</button>
            </div>
        </div>
        <div class="popup-content">
            <!-- Phase Plot -->
            <div class="viz-row">
                <div class="viz-panel" id="panel-phase-enhanced">
                    <div class="panel-header">ENHANCED PHASE PLOT</div>
                    <canvas id="enhanced-phase-main" width="400" height="280"></canvas>
                    <div class="panel-legend">
                        <span class="legend-item"><span class="legend-line cyan"></span> Trajectory</span>
                        <span class="legend-item"><span class="legend-dot blue"></span> ‚àöE amplitude bound</span>
                        <span class="legend-item"><span class="legend-line orange"></span> Frequency modes</span>
                    </div>
                    <div class="panel-note">
                        <small>üí° <b>Shape meaning:</b> Line = in-phase, Circle = 90¬∞ out of phase. Mode lines show eigenvector phase relationships.</small>
                    </div>
                </div>
            </div>
            
            <!-- Bottom Row: Spectrum, Energy, Time Series -->
            <div class="viz-row">
                <div class="viz-panel" id="panel-spectrum">
                    <div class="panel-header">FREQUENCY SPECTRUM</div>
                    <canvas id="enhanced-spectrum" width="280" height="150"></canvas>
                </div>
                <div class="viz-panel" id="panel-energy">
                    <div class="panel-header">ENERGY CONSERVATION</div>
                    <div class="energy-display">
                        <div class="energy-label">Energy:</div>
                        <div class="energy-bar-container">
                            <div id="energy-bar" class="energy-bar"></div>
                            <span id="energy-value" class="energy-value">1.0000</span>
                        </div>
                    </div>
                    <div id="energy-history" class="energy-history"></div>
                </div>
                <div class="viz-panel" id="panel-timeseries">
                    <div class="panel-header">TIME SERIES</div>
                    <canvas id="enhanced-timeseries" width="280" height="160"></canvas>
                </div>
            </div>
            
            <!-- Controls Row -->
            <div class="viz-controls-row">
                <label><input type="checkbox" id="viz-show-bounds" checked> Show b‚ÇÅ bound</label>
                <label><input type="checkbox" id="viz-show-eigenvectors" checked> Show mode frequencies</label>
                <label><input type="checkbox" id="viz-show-grid" checked> Show grid</label>
                <div class="zoom-controls">
                    <span>Zoom:</span>
                    <input type="range" id="viz-zoom" min="50" max="300" value="100">
                    <span id="viz-zoom-label">100%</span>
                </div>
            </div>
        </div>
        <div class="popup-resize-handle"></div>
    </div>

    <!-- Keyboard Shortcuts Hint -->
    <div class="keyboard-hint">
        <kbd>F</kbd> Fit to view &nbsp;|&nbsp; <kbd>Esc</kbd> Deselect
    </div>

    <script type="importmap">
    {
        "imports": {
            "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
            "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
        }
    }
    </script>

    <script type="module" src="main.js"></script>
</body>
</html>
